# adjusting p-value
res0.01 <- results(dds, alpha = 0.01)
summary(res0.01)

#change the result into data frame
res0.01 <- as.data.frame(res0.01)
class(res0.01)
res <- as.data.frame(res)
class(res)

#reorder res0.01 dataset by increasing P value
reorderres0.01 <- res0.01[order(res0.01$pvalue),]
head(reorderres0.01)

# checking specific gene differentially expressed, ex: FBgn0003360
res0.01["FBgn0003360",]
res0.01["FBgn0029167",]

# filter based on p-adjusted value
filtered <- res %>% filter(res$padj < 0.05)

#filter based on fold changes, with a threshold of 1
filtered <- filtered %>% filter(abs(filtered$log2FoldChange) > 1)

#save DESeq2 result, both of the original file (res) and filtered one (hits)
write.csv(res, "res.all.csv")
write.csv(filtered, "filtereddata.filter.csv")

#save normalized data
normalized <- counts(dds,normalized=TRUE)
head(normalized)
write.csv(normalized,"normalized_data.csv")
